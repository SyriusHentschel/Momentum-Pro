<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Application</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      color: #333;
    }
    .card {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    /* Button styles removed as they're no longer needed */
    pre {
      background-color: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      overflow-x: auto;
    }
    .steps {
      background-color: #fff8e1;
      border-left: 4px solid #ffc107;
      padding: 10px 15px;
      margin-bottom: 20px;
    }
    .countdown {
      font-weight: bold;
      color: #e53935;
    }
  </style>
</head>
<body>
  <h1>Application Reset Tool</h1>
  
  <div class="card">
    <h2>The Problem</h2>
    <p>You're seeing this error in the console:</p>
    <pre>service-worker.js:77 Uncaught (in promise) TypeError: Failed to execute 'put' on 'Cache': Request scheme 'chrome-extension' is unsupported</pre>
    <p>This happens because the service worker is trying to cache a chrome-extension URL, which isn't allowed.</p>
  </div>
  
  <div class="card steps">
    <h2>Automatic Reset Process</h2>
    <p>This page will:</p>
    <ol>
      <li>Automatically reset your application</li>
      <li>Clear all service workers and caches</li>
      <li>Redirect you to the application when complete</li>
    </ol>
    <p>Please wait while the reset process runs...</p>
  </div>
  
  <div class="card">
    <h2>Reset Status</h2>
    <div id="status"><p>Resetting application...</p></div>
  </div>
  
  <script>
    // Auto-run the reset process when the page loads
    window.addEventListener('load', async function() {
      const status = document.getElementById('status');
      
      try {
        // 1. Unregister all service workers
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          for (let registration of registrations) {
            await registration.unregister();
          }
          status.innerHTML += `<p>✅ Unregistered ${registrations.length} service worker(s)</p>`;
        }
        
        // 2. Clear all caches
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          for (let cacheName of cacheNames) {
            await caches.delete(cacheName);
          }
          status.innerHTML += `<p>✅ Cleared ${cacheNames.length} cache(s)</p>`;
        }
        
        // 3. Clear localStorage
        localStorage.clear();
        status.innerHTML += '<p>✅ Cleared local storage</p>';
        
        // 4. Clear sessionStorage
        sessionStorage.clear();
        status.innerHTML += '<p>✅ Cleared session storage</p>';
        
        status.innerHTML += '<p><strong>Reset complete!</strong></p>';
        
        // Redirect to the main application after a short delay
        status.innerHTML += '<p>Redirecting to application in <span class="countdown">3</span> seconds...</p>';
        
        let countdown = 3;
        const countdownElement = document.querySelector('.countdown');
        
        const timer = setInterval(() => {
          countdown--;
          if (countdown <= 0) {
            clearInterval(timer);
            window.location.href = '/';
          } else {
            countdownElement.textContent = countdown;
          }
        }, 1000);
        
      } catch (error) {
        status.innerHTML += `<p>❌ Error: ${error.message}</p>`;
      }
    });
  </script>
</body>
</html>